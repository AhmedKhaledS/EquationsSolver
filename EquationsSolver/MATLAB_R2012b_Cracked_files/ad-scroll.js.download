var browserheightfb = 0;
var banneroffsets = 0;
var resizeschk = 0;
var oldmsec = 0;

function getOffset(elem) {

    var box = elem.getBoundingClientRect()

    var body = document.body
    var docElem = document.documentElement

    var scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop
    var scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft

    var clientTop = docElem.clientTop || body.clientTop || 0
    var clientLeft = docElem.clientLeft || body.clientLeft || 0

    var top = box.top + scrollTop - clientTop
    var left = box.left + scrollLeft - clientLeft

    return { top: Math.round(top), left: Math.round(left) }
}


function getScrollTop() {
    var scrOfY = 0;
    if (typeof( window.pageYOffset ) == "number") {
        scrOfY = window.pageYOffset;
    } else if (document.body
        && ( document.body.scrollLeft
        || document.body.scrollTop )) {
        scrOfY = document.body.scrollTop;
    } else if (document.documentElement
        && ( document.documentElement.scrollLeft
        || document.documentElement.scrollTop )) {
        scrOfY = document.documentElement.scrollTop;
    }
    return scrOfY;
}

function fixPaneRefresh() {
    var bl = document.getElementById("sky-banner");
    if (bl != undefined) {
        bl.style.top = gettopvalue(bl) + "px";
    }

    var br = document.getElementById("sky-right");
    if (br != undefined) {
        br.style.top = gettopvalue(br) + "px";
    }
}


function banneroffsetsrefresh(msec, times) {
    msec = oldmsec + msec;
    oldmsec = msec;
    resizeschk = resizeschk + 1;

    if (resizeschk <= times) {
        setbanneroffsets();
        var fbody = "banneroffsetsrefresh(" + msec + "," + times + ")";
        setTimeout(fbody, msec);
    }
}

document.addEventListener('DOMContentLoaded', function () {
    setbanneroffsets();
    banneroffsetsrefresh(300, 10);
    window.addEventListener("scroll", function () {
        fixPaneRefresh();
    });

});

window.onresize = function (event) {
    setbanneroffsets();
}


function setbanneroffsets() {

    browserheightfb = getbrowserheight();

    var rbp = document.getElementById("main-content").offsetWidth + 10 + getOffset(document.getElementById("main-content")).left;
    rbp = Math.round(rbp) + 'px';
    var newstyle = "position:fixed;float:none;left:" + rbp + ";top:" + document.getElementById("sky-right").style.top;
    document.getElementById("sky-right").setAttribute("style", newstyle);

    var lbp = getOffset(document.getElementById("main-content")).left - 130;
    lbp = lbp + 'px';
    document.getElementById("sky-banner").style.left = lbp;

    var cbp = parseInt(document.getElementById("sky-center").width);
    cbp = ( ( cbp == 728 ) ? 90 : 210 ) + 'px';
    document.getElementById("sky-center").style.marginLeft = cbp;

    var el = document.getElementById('searchResult');
    var el2 = document.getElementById('detailsouterframe');
    if (el != undefined) {
        banneroffsets = getOffset(el).top;
    }
    else if (el2) {
        banneroffsets = getOffset(el2).top;
    } else {
        banneroffsets = getOffset(document.getElementById("sky-banner")).top;
    }
    fixPaneRefresh();
}


function gettopvalue(el) {
    var bh = browserheightfb;
    var co = banneroffsets;
    var ct = getScrollTop();


    var cv = co - ct;

    if (cv < 0)cv = 0;

    var topvalue = Math.round((bh - cv - 600) / 2 + cv);
    if (ct < co && topvalue < cv) {
        topvalue = cv;
    }
    else if (topvalue < 0) {
        topvalue = 0;
    }

    return topvalue;
}

function getbrowserheight() {
    var bHeight = 0;
    if (typeof( window.innerHeight ) == 'number') {
        bHeight = window.innerHeight;
    } else if (document.documentElement && (document.documentElement.clientHeight )) {
        bHeight = document.documentElement.clientHeight;
    }
    return bHeight
}
